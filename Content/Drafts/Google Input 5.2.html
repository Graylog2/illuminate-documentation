<?xml version="1.0" encoding="utf-8"?>
<html lang="en" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
        <link href="../Resources/TableStyles/Alternate-Row-Color.css" rel="stylesheet" MadCap:stylesheetType="table" />
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" /><title> Google Input
</title>
        <!-- original-url : google-input
## article-id : f248a92d-3523-4ea4-84af-a7d5ea62eb51
## seo-title : Google Input
## description : 
## Metadata_End -->
    </head>
    <body>
        <MadCap:snippetBlock src="../Resources/Snippets/OperationsFeatureBanner.flsnp" />
        <p>Similar to O365 and Okta, Graylog can gather logs from Google Services. The process to launch inputs for services is described below:</p>
        <ul>
            <li>Google Cloud (GCP)</li>
            <li>Google Workspace</li>
            <li>Gmail</li>
        </ul>
        <p>Depending on the integration, the steps differ by service. Each section is identified as:</p>
        <ul>
            <li>[All], if the instructions apply to all services mentioned above.</li>
            <li>[GCP], if the instructions only apply to the Google Cloud Platform.</li>
            <li>[Gmail], if the steps only apply to Gmail.</li>
            <li>[Workspace], if the steps apply to Google Workspace configuration.</li>
        </ul>
        <h2>Requirements</h2>
        <p>To successfully pull logs from these Google products into Graylog, you must have:</p>
        <ul>
            <li>a running instance of Graylog.</li>
            <li>Google Cloud account. See the <a href="https://cloud.google.com/free/">Cloud subdomain</a>.</li>
        </ul>
        <h2>[All] Caveats</h2>
        <p>Both the GPC and Gmail plugins create <a href="https://cloud.google.com/logging/docs/basic-concepts#sinks">log sinks</a> to fetch logs. Log data is then stored in Google BigQuery in your account. The Google inputs clean up the BigQuery tables periodically, but additional Google Cloud charges for BigQuery usage may apply.</p>
        <p>Like Okta and O365, Google inputs poll for data. Therefore, run them on a single node. Avoid running Google inputs as global inputs.</p>
        <h2>[All] Service Account Creation</h2>
        <p>
            <img src="../Resources/Images/Google Input/Service Account Creation.png" style="width: 563px;height: 460px;" />
        </p>
        <p>To collect logs for a project, enter the <a href="https://console.cloud.google.com/home/dashboard">Google Cloud Console</a>, and select the project. Note the Project ID, as it is required during Graylog input setup.</p>
        <p>Set up a new service account.</p>
        <ol>
            <li>Select <em>IAM &amp; Admin</em> &gt; <em>IAM</em> from the cloud dashboard.</li>
            <p>
                <img src="../Resources/Images/Google Input/IAM &amp; Admin.png" style="width: 469px;height: 393px;" />
            </p>
            <li>Select <em>Service Accounts</em> from the menu on the left.</li>
        </ol>
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<img src="../Resources/Images/Google Input/Service Accounts.png" alt="gcp-service-account" style="width: 468px;height: 590px;" /></p>
        <ol start="3">
            <li>Select <em>+CREATE SERVICE ACCOUNT</em> at the top of the page.</li>
        </ol>
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<img src="../Resources/Images/Google Input/+Create Service Account.png" style="width: 492px;height: 197px;" /></p>
        <ol start="4">
            <li>Note the <code data-backticks="1" class="linecode">Unique ID</code> associated with the service account, as it is needed to set up inputs.</li>
        </ol>
        <h2>[All] Generate Service Account Key</h2>
        <p>Generate a key file for the service account that will be placed on the Graylog server to allow inputs to authenticate with Google’s APIs.</p>
        <p>
            <img src="../Resources/Images/Google Input/Service Account Key.png" style="width: 544px;height: 298px;" />
        </p>
        <ol>
            <li>Navigate to the <em>Service Accounts</em> page. Select the intended service account.</li>
            <li>Click the <em>KEYS</em> tab on the sub-menu.</li>
        </ol>
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<img src="../Resources/Images/Google Input/Keys.png" alt="gcp-select-key" style="width: 541px;height: 260px;" /></p>
        <ol start="3">
            <li>Click on the <em>ADD KEY</em> button, and select <em>Create a new key</em>.</li>
        </ol>
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<img src="../Resources/Images/Google Input/Add keys.png" alt="gcp-create-key" /></p>
        <ol start="4">
            <li>Select <em>JSON</em> as the key type. Click <em>CREATE</em>.</li>
        </ol>
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<img src="../Resources/Images/Google Input/JSON.png" alt="gcp-json-key" /></p>
        <ol start="5">
            <li>Save the key in a safe location for input setup.</li>
            <li><strong>[Workspace]</strong> Create and download a P12 key for the Google Workspace input.</li>
        </ol>
        <h2>[All] Grant Permissions to the Service Account</h2>
        <p>The service account requires permissions to access log data and needs to store log data in Google BigQuery to allow Graylog to fetch the data.</p>
        <ol>
            <li>Click on the pencil icon to edit the <em>Principal</em> for the service account (found on the <em>IAM</em> page).</li>
        </ol>
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<img src="../Resources/Images/Google Input/Permissions.png" alt="gcp-edit-principal" /></p>
        <ol start="2">
            <li>Grant the service account the BigQuery Data Editor role.</li>
            <li>Grant the service account the BigQuery Jobs User role.</li>
            <li>Grant the service account the Logs Configuration Writer role.</li>
        </ol>
        <h2>[GCP] Enable Logging</h2>
        <p>To collect VPC flow logs, enable log. For more information, see <a href="https://cloud.google.com/vpc/docs/using-flow-logs">Using VPC Flow Logs</a>.</p>
        <p>To collect firewall logs, enable them in the firewall configuration.</p>
        <h2>[Workspace] Enable API Access</h2>
        <p>To enable access to Workspace endpoints:</p>
        <ol>
            <li>Log in as a user account in the Google Workspace with the <em>Super Admin</em> role.</li>
        </ol>
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<img src="../Resources/Images/Google Input/Super Admin.png" alt="gcp-admin-roles-privileges" /></p>
        <ol start="2">
            <li>Logged in as the super admin user, go to <a href="https://console.cloud.google.com">Google Cloud Platform</a> to create a new project or select an existing project. The project will need a service account as described above.</li>
            <li>Navigate to <em>APIs &amp; Services</em> &gt; <em>Library</em>.</li>
        </ol>
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<img src="../Resources/Images/Google Input/APIs &amp; Services.png" alt="gcp-api-library" /></p>
        <ol start="4">
            <li>Search for <em>Admin SDK API</em>. Click <em>Enable</em>.</li>
        </ol>
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<img src="../Resources/Images/Google Input/SDK API.png" alt="gcp-enable-sdk" /></p>
        <ol start="5">
            <li>Return to the Google Workspace console. Navigate to <em>Security</em> &gt; <em>API Controls</em> to link the service account to the API.</li>
        </ol>
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<img src="../Resources/Images/Google Input/API Controls.png" alt="gcp-api-config" /></p>
        <ol start="6">
            <li>Select <em>Manage Domain Wide Delegation</em>, and add a new API client.</li>
        </ol>
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<img src="../Resources/Images/Google Input/Add new API.png" alt="gcp-add-api-client" /></p>
        <ol start="7">
            <li>Use the numeric Unique ID of the service account for the Client ID, and add the following to the OAuth Scopes:
<ul><li><a href="https://www.googleapis.com/auth/admin.reports.audit.readonly"> https://www.googleapis.com/auth/admin.reports.audit.readonly</a></li><li><a href="https://www.googleapis.com/auth/iam">https://www.googleapis.com/auth/iam</a></li></ul></li>
        </ol>
        <h2>[GCP] Input Setup</h2>
        <table style="mc-table-style: url('../Resources/TableStyles/Alternate-Row-Color.css');width: 651px;" class="TableStyle-Alternate-Row-Color" cellspacing="21">
            <col style="width: 215px;" class="TableStyle-Alternate-Row-Color-Column-Column1" />
            <col style="width: 554px;" class="TableStyle-Alternate-Row-Color-Column-Column1" />
            <thead>
                <tr class="TableStyle-Alternate-Row-Color-Head-Header1">
                    <th class="TableStyle-Alternate-Row-Color-HeadE-Column1-Header1">Key</th>
                    <th class="TableStyle-Alternate-Row-Color-HeadD-Column1-Header1">Value</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">Input name</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body1">Add a unique name for the input</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body2">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">Project ID</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body2">Alphanumeric project ID for the Google Cloud project</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">Application (client) ID</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body1">Unique numeric ID of the service account</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body2">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">Service account key path</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body2">Path to <code data-backticks="1" class="linecode">.json</code> file for the service account</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyB-Column1-Body1">
                        <p class="table-text">BigQuery Dataset Region</p>
                    </td>
                    <td class="TableStyle-Alternate-Row-Color-BodyA-Column1-Body1">
                        <p>(<i>Optional</i>) The region where the Bigquery dataset will be created</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h2>
            <img src="../Resources/Images/Google Input/GCP Input Setup.png" />
        </h2>
        <h2>[Workspace] Input Setup</h2>
        <table style="mc-table-style: url('../Resources/TableStyles/Alternate-Row-Color.css');" class="TableStyle-Alternate-Row-Color" cellspacing="21">
            <thead>
                <tr class="TableStyle-Alternate-Row-Color-Head-Header1">
                    <th class="TableStyle-Alternate-Row-Color-HeadE-Column1-Header1">Key</th>
                    <th class="TableStyle-Alternate-Row-Color-HeadD-Column1-Header1">Value</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">Input name</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body1">&lt; Add a unique name for the input &gt;</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body2">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">Client ID</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body2">Unique numeric ID of the service account</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">Service Account ID</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body1">Email address of the service account</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body2">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">Account User Email</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body2">Workspace email address of the user that owns the project</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyB-Column1-Body1">Service account key path</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyA-Column1-Body1">Path to <code data-backticks="1" class="linecode">.p12</code> file for the service account</td>
                </tr>
            </tbody>
        </table>
        <p>
            <img src="../Resources/Images/Google Input/Google Workspace Input Setup.png" />
        </p>
        <h2>[Gmail] Input Setup</h2>
        <table style="mc-table-style: url('../Resources/TableStyles/Alternate-Row-Color.css');" class="TableStyle-Alternate-Row-Color" cellspacing="21">
            <thead>
                <tr class="TableStyle-Alternate-Row-Color-Head-Header1">
                    <th class="TableStyle-Alternate-Row-Color-HeadE-Column1-Header1">Key</th>
                    <th class="TableStyle-Alternate-Row-Color-HeadD-Column1-Header1">Value</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">Input name</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body1">&lt; Add a unique name for the input &gt;</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body2">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">Project ID</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body2">Alpha-numeric project ID for the Google Cloud project</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">Application (client) ID</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body1">Unique numeric ID of the service account</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body2">
                    <td class="TableStyle-Alternate-Row-Color-BodyB-Column1-Body2">Service account key path</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyA-Column1-Body2">Path to <code data-backticks="1" class="linecode">.json</code> file for the service account</td>
                </tr>
            </tbody>
        </table>
        <p>
            <img src="../Resources/Images/Google Input/Google Gmail Input.png" />
        </p>
    </body>
</html>