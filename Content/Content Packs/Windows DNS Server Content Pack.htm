<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
        <link href="Resources/TableStyles/Alternate-Row-Color.css" rel="stylesheet" MadCap:stylesheetType="table" /><title>Windows DNS Server Content Pack</title>
        <link href="Resources/Stylesheets/Styles.css" rel="stylesheet" />
    </head>
    <body>
        <MadCap:snippetBlock src="Resources/Snippets/IlluminateBanner.flsnp" />
        <p>Windows DNS Server is a core Windows Server role that provides domain name resolution services for internal and external network resources. This content pack enables comprehensive parsing of both Analytical and Audit DNS logs, offering deep visibility into query activity across clients, DNS resolution behaviors and metrics over time, and configuration changes. These logs are critical for detecting malicious use of DNS and maintaining infrastructure integrity.</p>
        <p><b>Analytical logs</b>, sourced from the Microsoft-Windows-DNSServer Event Tracing for Windows (ETW) provider, record every DNS query and response handled by the server. This high-volume telemetry is essential for monitoring name resolution patterns and identifying abnormal traffic such as DNS tunneling or data exfiltration. Designed for performance, ETW-based logging minimizes overhead even at high query rates.</p>
        <p><b>Audit logs</b>, captured from the Microsoft-Windows-DNS-Server/Audit channel, focus on administrative operations — changes to zones, resource records, DNSSEC, and server settings. These events are vital for detecting unauthorized modifications, maintaining an audit trail, and ensuring DNS infrastructure integrity.</p>
        <h2>Supported Version(s)</h2>
        <ul>
            <li>Windows Server 2016 and later</li>
        </ul>
        <section class="infoBox">
            <p><b>Hint:</b>  Analytic logs from enhanced DNS logging are available on Windows Server 2012 R2 with Hotfix KB2956577 as well, but the Filebeat agent version required for this pack does not support Windows Server 2012.</p>
        </section>
        <h2>Requirements</h2>
        <ul>
            <li>
                <p>Graylog 6.1.0+ with a valid Enterprise license</p>
            </li>
            <li>
                <p>Windows DNS Server installed and DNS Analytic/Audit logs enabled on the system (see below)</p>
            </li>
            <li>
                <p>Filebeat agent version 8.13.0 and higher running standalone (see below)</p>
            </li>
            <li>
                <p>Illuminate Core: DNS Processing Add-on Pack (optional for some spotlight widgets)</p>
            </li>
        </ul>
        <h2>Stream Configuration</h2>
        <p>This technology pack includes one stream:</p>
        <ul>
            <li>
                <p>"Illuminate:Windows DNS Server Event Messages"</p>
            </li>
        </ul>
        <p>
            <section class="infoBox">
                <div class="title" style="font-weight: normal;"><b>Hint</b>:  If this stream does not exist prior to the activation of this pack then it will be created and configured to route messages to this stream and the associated index set. There should not be any stream rules configured for this stream.</div>
            </section>
        </p>
        <h2>Index Set Configuration</h2>
        <p>This technology pack includes one index set definition:</p>
        <ul>
            <li>
                <p>"Windows DNS Server Event Messages"</p>
            </li>
        </ul>
        <p>
            <section class="infoBox">
                <div class="title" style="font-weight: normal;"><b>Hint</b>:  If this index set is already defined, then nothing will be changed. If this index set does not exist, then it will be created with retention settings of a daily rotation and 90 days of retention. These settings can be adjusted as required after installation.</div>
            </section>
        </p>
        <h2>Log Collection</h2>
        <p>This content pack requires <b>Filebeat</b> version 8.13.0 or higher for log collection due to the constraint that DNS Server Analytical logging exclusively relies on Event Tracing for Windows (ETW). Filebeat is one of the few log delivery agents that natively supports ETW through its ETW input module.</p>
        <p>It is important to note that <b>Filebeat must be run standalone</b>, not bundled with Graylog Sidecar. This is because the bundled Filebeat version is below version 8.13.0, which is the minimum required for compatibility with ETW.</p>
        <p>DNS Server Audit logs are enabled by default, but Analytic logs are not. Refer to the <a href="https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn800669(v=ws.11)#audit-and-analytic-event-logging">Microsoft documentation</a> on how to enable the DNS Server Analytic event log.</p>
        <p>
            <section class="infoBox">
                <div class="title" style="font-weight: normal;"><b>Hint</b>:  While NXLog Enterprise Edition is able to consume DNS Server Analytical events via ETW using its im_etw module, it is not compatible with this content pack due to differences in field conventions and log structure. Only Filebeat is officially supported.</div>
            </section>
        </p>
        <h2>Filebeat Standalone Configuration Example</h2>
        <p>Please refer to the <a href="https://www.elastic.co/docs/reference/beats/filebeat/filebeat-installation-configuration">official guide</a> to installing and configuring Filebeat for Windows.</p>
        <ol>
            <li>
                <p>Create a <a href="https://go2docs.graylog.org/current/getting_in_log_data/beats_input.html">Beats input</a> in Graylog. Ensure that the option <i>Do not add Beats type as prefix</i> is <b>disabled</b> (unchecked).</p>
            </li>
            <li>
                <p>See the following example Filebeat configuration:</p>
                <MadCap:codeSnippet>
                    <MadCap:codeSnippetCopyButton />
                    <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve"># Needed for Graylog
fields_under_root: true

output.logstash:
    hosts: ["GRAYLOG_SERVER:5044"]

path:
    data: C:\Program Files\Filebeat\data
    logs: C:\Program Files\Filebeat\logs

tags:
- windows

filebeat.inputs:
- type: etw
    id: etw-dnsserver
    enabled: true
    provider.name: Microsoft-Windows-DNSServer
    session_name: DNSServer-Analytical  # IMPORTANT for parsing to recognize Analytical events
    trace_level: verbose
    match_any_keyword: 0x8000000000000000
    match_all_keyword: 0

- type: winlog
    id: winlog-dnsserver-audit
    enabled: true
    name: "Microsoft-Windows-DNSServer/Audit"
    ignore_older: 24h</MadCap:codeSnippetBody>
                </MadCap:codeSnippet>
                <p>
                    <section class="infoBox">
                        <div class="title" style="font-weight: normal;"><b>Hint</b>:  Note that the parser for this pack requires the user-defined <code class="linecode">session_name</code> to be <code class="linecode">DNSServer-Analytical</code> (case-insensitive) in order to identify Analytic log events.</div>
                    </section>
                </p>
            </li>
            <li>
                <p>Edit the Filebeat config to ship to your Graylog server IP or hostname.</p>
            </li>
            <li>
                <p>Ensure that DNS Server Analytic and Audit logs are enabled for the system.</p>
            </li>
        </ol>
        <h2 id="what-is-provided">What is Provided</h2>
        <ul>
            <li>
                <p>Parsing rules to extract Windows DNS Server Analytic and Audit event logs into Graylog schema compatible fields</p>
            </li>
            <li>
                <p>Field normalization and data enrichment for additional investigative context</p>
            </li>
            <li>
                <p>Illuminate Spotlight dashboard to support DNS transactional and administrative activity monitoring, provide useful insights into DNS patterns across the network, and highlight potential security threats</p>
            </li>
        </ul>
        <h2 id="events-processed-by-this-technology-pack">Events Processed by This Technology Pack</h2>
        <p>The Windows DNS Server content pack supports the following events. Generic processing will be provided for any Event IDs not listed.</p>
        <h3>Event IDs</h3>
        <table style="width: 100%;mc-table-style: url('Resources/TableStyles/Alternate-Row-Color.css');" class="TableStyle-Alternate-Row-Color" cellspacing="21">
            <col class="TableStyle-Alternate-Row-Color-Column-Column1" />
            <col class="TableStyle-Alternate-Row-Color-Column-Column1" />
            <col class="TableStyle-Alternate-Row-Color-Column-Column1" />
            <thead>
                <tr class="TableStyle-Alternate-Row-Color-Head-Header1">
                    <th class="TableStyle-Alternate-Row-Color-HeadE-Column1-Header1">&#160;</th>
                    <th class="TableStyle-Alternate-Row-Color-HeadE-Column1-Header1">&#160;</th>
                    <th class="TableStyle-Alternate-Row-Color-HeadD-Column1-Header1">&#160;</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body1">&#160;</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body2">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body2">&#160;</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body1">&#160;</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body2">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body2">&#160;</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyB-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyB-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyA-Column1-Body1">&#160;</td>
                </tr>
            </tbody>
        </table>
        <h3>GIM Categorization</h3>
        <p>GIM categorization is provided for the following messages:</p>
        <table style="width: 100%;mc-table-style: url('Resources/TableStyles/Alternate-Row-Color.css');" class="TableStyle-Alternate-Row-Color" cellspacing="21">
            <col class="TableStyle-Alternate-Row-Color-Column-Column1" />
            <col class="TableStyle-Alternate-Row-Color-Column-Column1" />
            <col class="TableStyle-Alternate-Row-Color-Column-Column1" />
            <thead>
                <tr class="TableStyle-Alternate-Row-Color-Head-Header1">
                    <th class="TableStyle-Alternate-Row-Color-HeadE-Column1-Header1">&#160;</th>
                    <th class="TableStyle-Alternate-Row-Color-HeadE-Column1-Header1">&#160;</th>
                    <th class="TableStyle-Alternate-Row-Color-HeadD-Column1-Header1">&#160;</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body1">&#160;</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body2">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body2">&#160;</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body1">&#160;</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body2">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body2">&#160;</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyB-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyB-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyA-Column1-Body1">&#160;</td>
                </tr>
            </tbody>
        </table>
        <h3>Parsed Fields</h3>
        <p>This pack parses out the following fields. Note that this list is not comprehensive.</p>
        <table style="width: 100%;mc-table-style: url('Resources/TableStyles/Alternate-Row-Color.css');" class="TableStyle-Alternate-Row-Color" cellspacing="21">
            <col class="TableStyle-Alternate-Row-Color-Column-Column1" />
            <col class="TableStyle-Alternate-Row-Color-Column-Column1" />
            <col class="TableStyle-Alternate-Row-Color-Column-Column1" />
            <thead>
                <tr class="TableStyle-Alternate-Row-Color-Head-Header1">
                    <th class="TableStyle-Alternate-Row-Color-HeadE-Column1-Header1">&#160;</th>
                    <th class="TableStyle-Alternate-Row-Color-HeadE-Column1-Header1">&#160;</th>
                    <th class="TableStyle-Alternate-Row-Color-HeadD-Column1-Header1">&#160;</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body1">&#160;</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body2">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body2">&#160;</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body1">&#160;</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body2">
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyE-Column1-Body2">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyD-Column1-Body2">&#160;</td>
                </tr>
                <tr class="TableStyle-Alternate-Row-Color-Body-Body1">
                    <td class="TableStyle-Alternate-Row-Color-BodyB-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyB-Column1-Body1">&#160;</td>
                    <td class="TableStyle-Alternate-Row-Color-BodyA-Column1-Body1">&#160;</td>
                </tr>
            </tbody>
        </table>
        <h2 id="spotlight-content-pack">Windows DNS Server Spotlight Content Pack</h2>
        <p>Windows DNS Server Spotlight offers a dashboard with 3 tabs:</p>
        <h3>DNS Analytic Events</h3>
        <p>
            <img src="../Resources/Images/Windows DNS Server Content Pack/analytic_12.png" />
            <img src="../Resources/Images/Windows DNS Server Content Pack/analytic_34.png" />
        </p>
        <h3>DNS Audit Events</h3>
        <p>
            <img src="../Resources/Images/Windows DNS Server Content Pack/audit_12.png" />
            <img src="../Resources/Images/Windows DNS Server Content Pack/audit_34.png" />
        </p>
        <h3>Domain Analysis</h3>
        <p>
            <img src="../Resources/Images/Windows DNS Server Content Pack/domain_123.png" />
        </p>
    </body>
</html>