<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
        <link href="Resources/TableStyles/Alternate-Row-Color.css" rel="stylesheet" MadCap:stylesheetType="table" /><title>Windows AppLocker Content Pack</title>
        <link href="Resources/Stylesheets/Styles.css" rel="stylesheet" />
    </head>
    <body>
        <MadCap:snippetBlock src="Resources/Snippets/IlluminateBanner.flsnp" />
        <p><span>Windows AppLocker is an optional security feature that helps organizations control which apps and files users can run, including executables, dynamic-link libraries (DLLs), scripts, installers and packaged apps.</span>
        </p>
        <h2>Supported Version(s)</h2>
        <ul>
            <li><span>Windows 8 or later, recommended Windows 10/11 or Server 2022+</span>
            </li>
        </ul>
        <p>
            <section class="infoBox">
                <div class="title" style="font-weight: normal;"><b>Hint</b>:&#160;AppLocker feature availability is highly dependent on the Windows edition and version in use. Please refer to the <a href="https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/requirements-to-use-applocker">Microsoft documentation</a> for detailed requirements.</div>
            </section>
        </p>
        <h2>Requirements</h2>
        <ul>
            <li><span>Graylog 6.0.1+ with a valid Enterprise license</span>
            </li>
        </ul>
        <ul>
            <li><span>AppLocker policies must be enabled and rules created via Group Policy or Local Security Policy</span>
            </li>
        </ul>
        <h2>Stream Configuration</h2>
        <p>This technology pack includes one stream:</p>
        <ul>
            <li><span>Illuminate:Windows AppLocker Event Log Messages</span>
            </li>
        </ul>
        <p>
            <section class="infoBox">
                <div class="title" style="font-weight: normal;"><b>Hint</b>:  If this stream does not exist prior to the activation of this pack then it will be created and configured to route messages to this stream and the associated index set. There should not be any stream rules configured for this stream.</div>
            </section>
        </p>
        <h2>Index Set Configuration</h2>
        <p>This technology pack includes one index set definition:</p>
        <ul>
            <li><span>Windows AppLocker Event Log Messages</span>
            </li>
        </ul>
        <p>
            <section class="infoBox">
                <div class="title" style="font-weight: normal;"><b>Hint</b>:  If this index set is already defined, then nothing will be changed. If this index set does not exist, then it will be created with retention settings of a daily rotation and 90 days of retention. These settings can be adjusted as required after installation.</div>
            </section>
        </p>
        <h2>Log Collection</h2>
        <p>The following log delivery agents are supported:</p>
        <ul>
            <li><span>Winlogbeat</span>
            </li>
        </ul>
        <ul>
            <li><span>NXLog Enterprise Edition</span>
            </li>
        </ul>
        <ul>
            <li><span>NXLog Community Edition (limited support)</span>
            </li>
        </ul>
        <p>
            <section class="infoBox">
                <div class="title" style="font-weight: normal;"><b>Hint</b>:  NXLog Community Edition does not send the RuleAndFileData XML portion of the event. This suppressed event data contains key fields that are important for effective AppLocker activity monitoring. Due to this limitation, we recommend to use NXLog Enterprise or Winlogbeat instead.</div>
            </section>
        </p>
        <h2>Graylog Sidecar Example Configuration</h2>
        <ol>
            <li>
                <p>Please refer to the official documentation to <a href="https://go2docs.graylog.org/current/getting_in_log_data/graylog_sidecar.html">set up Graylog Sidecar</a>.</p>
            </li>
            <li>
                <p>Create a <a href="https://go2docs.graylog.org/current/getting_in_log_data/beats_input.html">Beats input</a> for Winlogbeat or a <a href="https://go2docs.graylog.org/current/getting_in_log_data/gelf.html">GELF input</a> for NXLog in Graylog.</p>
            </li>
            <li>
                <p>When sending to a Beats input, ensure that the option <i>Do not add Beats type as prefix</i> is <strong>disabled</strong>.</p>
            </li>
            <li>
                <p>Create an API access token and a custom configuration for your chosen log delivery agent.</p>
            </li>
            <li>
                <p>See the following example configuration for Winlogbeat:</p>
                <MadCap:codeSnippet>
                    <MadCap:codeSnippetCopyButton />
                    <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve"># Needed for Graylog
fields_under_root: true
fields.collector_node_id: ${sidecar.nodeName}
fields.gl2_source_collector: ${sidecar.nodeId}

output.logstash:
  hosts: ["${user.graylog_host}:5044"]
path:
  data: ${sidecar.spoolDir!"C:\\Program Files\\Graylog\\sidecar\\cache\\winlogbeat"}\data
  logs: ${sidecar.spoolDir!"C:\\Program Files\\Graylog\\sidecar"}\logs
tags:
  - windows
winlogbeat:
  event_logs:
    - name: "Microsoft-Windows-AppLocker/EXE and DLL"
      ignore_older: 24h
    - name: "Microsoft-Windows-AppLocker/MSI and SCRIPT"
      ignore_older: 24h
    - name: "Microsoft-Windows-AppLocker/Packaged app-Deployment"
      ignore_older: 24h
    - name: "Microsoft-Windows-AppLocker/Packaged app-Execution"
      ignore_older: 24h</MadCap:codeSnippetBody>
                </MadCap:codeSnippet>
            </li>
            <li>
                <p>See the following example configuration for NXLog:</p>
                <p>This configuration requires NXLog to be installed in <code class="linecode">C:\Program Files (x86)\nxlog</code> and not in the default folder.</p>
                <MadCap:codeSnippet>
                    <MadCap:codeSnippetCopyButton />
                    <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">define ROOT C:\Program Files (x86)\nxlog

Moduledir %ROOT%\modules
CacheDir %ROOT%\data
Pidfile %ROOT%\data\nxlog.pid
SpoolDir %ROOT%\data
LogFile %ROOT%\data\nxlog.log
LogLevel INFO

&lt;Extension logrotate&gt;
    Module  xm_fileop
    &lt;Schedule&gt;
        When    @daily
        Exec    file_cycle('%ROOT%\data\nxlog.log', 7);
    &lt;/Schedule&gt;
&lt;/Extension&gt;

&lt;Extension gelfExt&gt;
    Module xm_gelf
    # Avoid truncation of the short_message field to 64 characters.
    ShortMessageLength 65536
&lt;/Extension&gt;

&lt;Input eventlog&gt;
    Module im_msvistalog
    PollInterval 1
    SavePos True
    ReadFromLast True

    &lt;QueryXML&gt;
        &lt;QueryList&gt;
            &lt;Query Id='1'&gt;
                &lt;Select Path="Microsoft-Windows-AppLocker/EXE and DLL"&gt;*&lt;/Select&gt;
                &lt;Select Path="Microsoft-Windows-AppLocker/MSI and Script"&gt;*&lt;/Select&gt;
                &lt;Select Path="Microsoft-Windows-AppLocker/Packaged app-Deployment"&gt;*&lt;/Select&gt;
                &lt;Select Path="Microsoft-Windows-AppLocker/Packaged app-Execution"&gt;*&lt;/Select&gt;
            &lt;/Query&gt;
        &lt;/QueryList&gt;
    &lt;/QueryXML&gt;
&lt;/Input&gt;

&lt;Output gelf&gt;
    Module om_tcp
    Host ${user.graylog_host}
    Port 12201
    OutputType  GELF_TCP
    &lt;Exec&gt;
        # These fields are needed for Graylog
        $gl2_source_collector = '${sidecar.nodeId}';
        $collector_node_id = '${sidecar.nodeName}';
    &lt;/Exec&gt;
&lt;/Output&gt;

&lt;Route route-1&gt;
    Path eventlog =&gt; gelf
&lt;/Route&gt;
</MadCap:codeSnippetBody>
                </MadCap:codeSnippet>
            </li>
            <li>
                <p>Install Graylog Sidecar on the client host.</p>
            </li>
            <li>
                <p>Edit the Graylog Sidecar client configuration with your Graylog server API URL and API access token.</p>
            </li>
        </ol>
        <h2 id="what-is-provided">What is Provided</h2>
        <ul>
            <li>
                <p>Parsing rules to extract Windows AppLocker event logs into Graylog schema compatible fields
                </p>
            </li>
            <li>
                <p>Illuminate spotlight highlighting security events and statistics of interest
                </p>
            </li>
        </ul>
        <h2 id="events-processed-by-this-technology-pack">Events Processed by This Technology Pack</h2>
        <p>The Windows AppLocker content pack supports the following event IDs. Generic processing will be provided for event IDs not listed.</p>
        <table>
            <!--This table contains event IDs and descriptions, **see attachment in PR**-->
        </table>
        <h2 id="message-fields-included-in-this-pack">Message Fields Included in This Pack</h2>
        <table>
            <!--This table contains parsed fields, **see attachment in PR**-->
        </table>
        <h2 id="spotlight-content-pack">Windows AppLocker Spotlight Content Pack</h2>
        <p>Windows AppLocker offers a dashboard with 6 tabs:</p>
        <ul>
            <li>
                <p>AppLocker Events Overview</p>
            </li>
        </ul>
        <p>
            <img src="../Resources/Images/Windows AppLocker Content Pack/overview.png">
        </p>
        <ul>
            <li>
                <p>EXE</p>
            </li>
        </ul>
        <p>
            <img src="../Resources/Images/Windows AppLocker Content Pack/exe.png">
        </p>
        <ul>
            <li>
                <p>DLL</p>
            </li>
        </ul>
        <p>
            <img src="../Resources/Images/Windows AppLocker Content Pack/dll.png">
        </p>
        <ul>
            <li>
                <p>MSI</p>
            </li>
        </ul>
        <p>
            <img src="../Resources/Images/Windows AppLocker Content Pack/msi.png">
        </p>
        <ul>
            <li>
                <p>SCRIPT</p>
            </li>
        </ul>
        <p>
            <img src="../Resources/Images/Windows AppLocker Content Pack/script.png">
        </p>
        <ul>
            <li>
                <p>APPX</p>
            </li>
        </ul>
        <p>
            <img src="../Resources/Images/Windows AppLocker Content Pack/appx.png">
        </p>
    </body>
</html>