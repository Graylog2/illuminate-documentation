<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" xml:lang="en-us">
    <head><title>Apache Tomcat Server Content Pack</title>
        <link href="../Resources/Stylesheets/Styles.css" rel="stylesheet" />
    </head>
    <body>
        <p class="NormalWeb">Apache Tomcat Server on a Linux system. This pack will parse out and configure Apache Tomcat access and Catalina logs.</p>
        <h2 class="Heading2">Supported Version(s)</h2>
        <ul>
            <li>
                <p class="NormalWeb">Tested with Version 11.0.5<br /></p>
            </li>
        </ul>
        <h2 class="Heading2">What is Provided?</h2>
        <ul>
            <li>
                <p class="NormalWeb">Parsing rules to extract Apache Tomcat logs into Graylog schema-compatible fields. Apache Tomcat logs get the GIM code “180200” (http.communication).</p>
            </li>
        </ul>
        <h2 class="Heading2">Stream Configuration</h2>
        <p class="NormalWeb">This technology pack includes one stream:</p>
        <ul>
            <li>
                <p class="NormalWeb">"Illuminate:Apache2 Device Messages"</p>
            </li>
        </ul>
        <p>
            <section class="infoBox">
                <div class="title" style="font-weight: normal;"><b>Hint</b>:&#160;If this stream does not exist prior to the activation of this pack then it will be created and configured to route messages to this stream and the associated index set. There should not be any stream rules configured for this stream. </div>
            </section>
        </p>
        <h2 class="Heading2">Index Set Configuration</h2>
        <p class="NormalWeb">This technology pack includes one index set definition:</p>
        <ul>
            <li>
                <p class="NormalWeb">“Illuminate: Apache2 Messages”</p>
            </li>
        </ul>
        <p>
            <section class="infoBox">
                <div class="title" style="font-weight: normal;"><b>Hint</b>:&#160;If this index set is already defined, then nothing will be changed. Index settings can be adjusted as required after installation. </div>
            </section>
        </p>
        <h2 class="Heading2">Log Format Example</h2>
        <h3>Access Logs</h3>
        <p><code class="linecode">"34.20.30.15 - - [28/Mar/2025:23:34:30 +0000] "PUT /stefan.session HTTP/1.1" 201 -"</code>
        <p><code class="linecode">"11.20.29.124 - admin [02/Mar/2023:18:58:17 +0530] "POST /host-manager/images/asf-logo.svg HTTP/1.1" 200 20486 X 400 "http://localhost:8080/host-manager/html" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36" X-Forwarded-For="127.0.0.1"</code>
        </p>
        <h3>Catalina Logs </h3>
        <p><code class="linecode">26-Mar-2025 15:27:08.188 INFO [main] org.apache.catalina.core.StandardService.startInternal Starting service [Catalina]</code>
        </p>
        <h2 class="Heading2">Requirements</h2>
        <ul>
            <li>
                <p class="NormalWeb">Supported log delivery: Filebeat (with Sidecar)</p>
            </li>
            <li>
                <p class="NormalWeb">The pack only supports Ubuntu and Linux versions with the same path and file structure. We may add support for other Linux systems at one point.</p>
            </li>
            <li>
                <p class="NormalWeb">The pack only supports the standard log folder for Ubuntu.</p>
            </li>
        </ul>
        <h3 class="Heading3">Input via Filebeat together with Graylog Sidecar</h3>
        <p class="NormalWeb">Please use <a href="https://go2docs.graylog.org/5-0/getting_in_log_data/graylog_sidecar.html">the official Graylog Sidecar documentation</a> to configure your Graylog server and your client(s).</p>
        <ol>
            <li>
                <p class="NormalWeb">Create an input and an API key and set up Graylog Sidecar.<br /></p>
            </li>
            <li>
                <p class="NormalWeb">Add your client(s), e.g. web server.</p>
            </li>
        </ol>
        <p>
            <section class="infoBox">
                <div class="title" style="font-weight: normal;"><b>Hint</b>: It is possible to run the Apache Tomcat Server and Graylog on the same machine.</div>
            </section>
        </p>
        <h2>Graylog Server Settings</h2>
        <p class="NormalWeb">1. <a href="https://go2docs.graylog.org/current/getting_in_log_data/beats_input.html">Create a global Beats input</a> in Graylog.</p>
        <p class="NormalWeb">2. <a href="https://go2docs.graylog.org/current/setting_up_graylog/rest_api.html">Create a Graylog REST API access token</a> and save it.</p>
        <p class="NormalWeb">3. Create a (Linux) filebeat configuration under <i>Sidercar </i>&gt;<i>&#160;Configuration</i> with a "filebeat on linux" collector.</p>
        <p class="NormalWeb">4. Configure the file and add:</p>
        <ul class="ul_2">
            <li class="NormalWeb">
                <p class="NormalWeb">The correct IP (Graylog server IP) under hosts.</p>
            </li>
            <li class="NormalWeb">
                <p class="NormalWeb">The log source configured to the desired value and a field <code class="linecode">event_source_product</code> with the value <code class="linecode">apache_tomcat</code>.</p>
            </li>
        </ul>
        <MadCap:codeSnippet>
            <MadCap:codeSnippetCopyButton />
            <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">filebeat.inputs:
- input_type: log
  paths:
    - /opt/tomcat/updated/logs/*
  type: filestream
  fields_under_root: true
  fields:
    event_source_product: apache_tomcat</MadCap:codeSnippetBody>
        </MadCap:codeSnippet>
        <p>
            <section class="warningBox">
                <div class="title" style="font-weight: normal;"><b>Warning</b>:&#160;There must be two spaces in front of <code class="linecode">event_source_product</code> and <code class="linecode">- /var... </code>.</div>
            </section>
        </p>
        <p class="NormalWeb">This setting will pull all logs in the - /opt/tomcat/updated/logs/* folder. If needed, only select access logs or catalina logs</p>
        <p class="NormalWeb">5. Finally, save the configuration.</p>
        <h2>Configure a Client with Filebeat and Graylog Sidecar</h2>
        <p class="NormalWeb">1. Install Sidecar on the remote machine.<br /></p>
        <MadCap:codeSnippet>
            <MadCap:codeSnippetCopyButton />
            <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">wget https://packages.graylog2.org/repo/packages/graylog-sidecar-repository_1-5_all.deb
sudo dpkg -i graylog-sidecar-repository_1-5_all.deb
sudo apt-get update &amp;&amp; sudo apt-get install graylog-sidecar</MadCap:codeSnippetBody>
        </MadCap:codeSnippet>
        <p class="NormalWeb">2. Edit the <code class="linecode">/etc/graylog/sidecar/sidecar.yml</code> file and configure:</p>
        <ul>
            <li>
                <p class="NormalWeb"><code class="linecode">server_url</code>: GraylogServerIP</p>
            </li>
            <li>
                <p class="NormalWeb"><code class="linecode">server_api_token</code>: Your API token<br /></p>
            </li>
        </ul>
        <MadCap:codeSnippet>
            <MadCap:codeSnippetCopyButton />
            <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">sudo gedit /etc/graylog/sidecar/sidecar.yml
server_url: "http://192.168.122.52:9000/api/"
server_api_token: "65ol7edseo24mub8o7pu86h2rsr8j9fjjpimtrm9nrpbjso7cnv"
</MadCap:codeSnippetBody>
        </MadCap:codeSnippet>
        <p class="NormalWeb">3. Install, enable, and verify the Sidecar service. </p>
        <MadCap:codeSnippet>
            <MadCap:codeSnippetCopyButton />
            <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">sudo graylog-sidecar -service install
sudo systemctl enable graylog-sidecar
sudo systemctl start graylog-sidecar
sudo systemctl status graylog-sidecar</MadCap:codeSnippetBody>
        </MadCap:codeSnippet>
        <p>
            <section class="warningBox">
                <div class="title" style="font-weight: normal;"><b>Warning</b>:&#160;The provided commands are only examples; please use your IP and API token. For example commands for Ubuntu, refer the <a href="https://go2docs.graylog.org/5-0/getting_in_log_data/graylog_sidecar.html#:~:text=Graylog Sidecar is a lightweight,the configurations of log collectors.">official documentation</a>.</div>
            </section>
        </p>
        <p class="NormalWeb">4. Install filebeats <a href="https://www.elastic.co/downloads/beats/filebeat">according to the documentation</a>. Or, here is <a href="https://www.elastic.co/downloads/beats/filebeat-oss">the download link</a> for the OSS version.</p>
        <ul>
            <li>
                <p class="NormalWeb"> If you install it manually, install it again under <code class="linecode">/etc/filebeat</code>.<br /></p>
            </li>
            <li>
                <p class="NormalWeb">If you install it via apt-get, then it is in the correct folder.</p>
            </li>
        </ul>
        <p class="NormalWeb">Example commands for Ubuntu:</p>
        <MadCap:codeSnippet>
            <MadCap:codeSnippetCopyButton />
            <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
sudo apt-get install apt-transport-https
echo "deb https://artifacts.elastic.co/packages/oss-8.x/apt stable main" | sudo tee -a /etc/apt/sources.list.d/elastic-8.x.list
sudo apt-get update &amp;&amp; sudo apt-get install filebeat
sudo systemctl enable filebeat
sudo systemctl start filebeat
sudo systemctl status filebeat</MadCap:codeSnippetBody>
        </MadCap:codeSnippet>
        <p class="NormalWeb">5. <i>Optional</i>. Edit the <code class="linecode">filebeat.ym</code>l file as needed. You do this via the Sidecar configuration in Graylog.<br />6. Start the deamon.<br />7. If there is a permission issue, you can resolve with:</p>
        <MadCap:codeSnippet>
            <MadCap:codeSnippetCopyButton />
            <MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve">sudo chown root filebeat.yml</MadCap:codeSnippetBody>
        </MadCap:codeSnippet>
        <p class="NormalWeb">8. In Graylog, assign a configuration to your machine.</p>
        <h2 class="Heading2">Limitations</h2>
        <ul>
            <li>
                <p class="NormalWeb">This pack works for Ubuntu systems only. Error logs are not parsed.</p>
            </li>
        </ul>
    </body>
</html>
